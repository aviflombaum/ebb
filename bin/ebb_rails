#!/usr/bin/env ruby
require File.dirname(__FILE__) + '/../ruby_lib/ebb'
require 'optparse'
require 'rubygems'
require 'rack'

module Rack
  module Adapter
    autoload :Rails, Ebb::LIBDIR + '/rack/adapter/rails'
  end
end

class EbbRails < Ebb::Runner
  def extra_options
    # defaults for ebb_rails
    @options.update(
      :environment => 'development',
      :port => 3000,
      # rails has a mutex lock around each request - threaded processing
      # will only slow things down
      :threaded_processing => false
    )
    
    @parser.on("-e", "--env ENV", 
            "Rails environment (default: development)") do |env| 
      @options[:environment] = env
    end
    @parser.on("-c", "--chdir DIR", "RAILS_ROOT directory") do |c| 
      @options[:root] = c
    end
  end
  
  def app(options)
    Rack::Adapter::Rails.new(options)
  end
end

EbbRails.new(ARGV).run
